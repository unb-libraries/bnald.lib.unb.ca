id: legislation
label: 'Legislation Nodes to Legislation Entities'
migration_group: bnald
migration_tags:
  - Drupal 7
source:
  plugin: d7_node
  key: migrate
  node_type: piece_of_legislation
process:
  vid: vid
  langcode:
    plugin: default_value
    source: language
    default_value: "und"
  province:
    plugin: migration_lookup
    migration: provinces
    source: field_provinces
  pdf_original:
    -
      plugin: extract
      source: field_pdf_of_legislation
      index:
        - 0
        - fid
    -
      plugin: file_name
      path: '/app/content/files'
    -
      plugin: file_import
      skip_on_missing_source: true
  pdf_transcript:
    -
      plugin: extract
      source: field_pdf_of_legislation_full_te
      index:
        - 0
        - fid
    -
      plugin: file_name
      path: '/app/content/files'
    -
      plugin: file_import
      skip_on_missing_source: true
  legislation_title: field_legislation_title
  number_articles: field_number_of_articles
  legislative_summary: field_legislative_summary
  legislative_full: field_full_legislative_text
  item_notes: field_item_notes
  source_document:
    plugin: migration_lookup
    migration: source_documents
    source: field_source_document
  year_passed:
    - plugin: extract
      source: field_date_legislation_passed
      index:
        - 0
        - value
      default: '0000'
    - plugin: substr
      length: 4
  jurisdictional_relevance:
    plugin: migration_lookup
    migration: jurisdictional_relevances
    source: field_jurisdictional_relevance
  concepts:
    plugin: migration_lookup
    migration: concepts
    source: field_concepts
  chapter: field_chapter
  chapter_sort: field_chapter_sort
  user_id:
    plugin: migration_lookup
    migration: d7_user
    source: node_uid
  status: status
  created: created
  changed: timestamp
destination:
  plugin: entity:legislation
migration_dependencies:
  required:
    - d7_user
    - concepts
    - jurisdictional_relevances
    - provinces
    - source_documents